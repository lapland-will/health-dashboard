# 金明健康看板系统 - 死命令与完整需求文档

**文档版本：** v1.0 - 终极版
**创建时间：** 2026-02-04
**最后更新：** 2026-02-04
**状态：** ⚠️ **死命令 - 必须严格执行**

---

## ⚠️⚠️⚠️ 死命令（最高优先级）

### 🚨 死命令 #1：每次更新前必须检查此文档

**命令内容：**
> **每次涉及看板更新前，必须先完整阅读本需求文档，逐条对照检查，确保每一条要求都完整满足。绝对不允许顾此失彼！**

**执行要求：**
1. 更新任何代码前，必须先读取本文档
2. 逐条检查所有需求
3. 确保没有遗漏任何要求
4. 更新后必须验证所有功能都正常工作
5. 绝对不允许"顾此失彼"

**验证清单：**
- [ ] 所有图表都存在且正常显示
- [ ] 所有文字建议都存在且完整
- [ ] 所有可视化都存在且美观
- [ ] 所有数据都正确显示
- [ ] 没有任何功能缺失
- [ ] 没有任何内容丢失

**违规后果：**
- 如果违反此命令，会被严厉批评
- 必须立即修复所有问题

---

### 🚨 死命令 #2：只增加、不减少

**命令内容：**
> **所有功能和数据只能增加，绝对不能减少。每次更新必须保留所有已有内容，只能添加新功能。**

**执行要求：**
1. 更新前必须列出所有现有功能
2. 更新后必须验证所有功能都还在
3. 新增功能必须添加，不能替换
4. 绝对不允许删除任何内容

**禁止行为：**
- ❌ 删除任何已有的建议内容
- ❌ 删除任何已有的图表
- ❌ 删除任何已有的数据
- ❌ 简化或缩短任何内容

**必须行为：**
- ✅ 保留所有原有内容
- ✅ 添加新内容在原有内容之后
- ✅ 确保所有功能都正常工作

---

### 🚨 死命令 #3：可视化越多越好

**命令内容：**
> **可视化图表越多越好，给的东西越多越好。包括过去7天、30天甚至更长时间的历史数据和趋势分析。**

**要求：**
- 至少包含所有已有图表
- 必须包含matplotlib图表
- 必须包含Chart.js交互式图表
- 必须包含进度条可视化
- 必须包含7天趋势
- 必须包含30天趋势
- 必须包含营养可视化
- 必须包含训练可视化

**图表类型：**
1. 雷达图 - 健康指标
2. 柱状图 - 睡眠质量
3. 饼图/环形图 - 活动分布
4. 仪表盘 - 训练准备度
5. 折线图 - 趋势分析
6. 进度条 - 各项指标
7. 热图 - 相关性分析
8. 箱线图 - 数据分布
9. 直方图 - 频率分布
10. 日历热图 - 训练日历

---

### 🚨 死命令 #4：每天11点必须推送更新

**命令内容：**
> **每天上午11:00（北京时间）必须自动推送更新，调用所有最新API数据，识别有道云笔记中的训练日志，并更新到在线网站。**

**执行要求：**
1. **时间要求：** 每天上午11:00（北京时间）必须执行
2. **API调用：** 必须调用所有最新数据
   - ✅ Oura Ring API（睡眠、准备度、活动、心率）
   - ✅ 天气API（实时天气、空气质量、紫外线）
   - ✅ 空气质量API（AQI、PM2.5、PM10）
3. **训练日志识别：** 必须读取有道云笔记
   - ✅ 识别昨天的训练记录
   - ✅ 自动提取训练内容（日期、类型、时长、强度、主观感受）
   - ✅ 更新到训练日志系统
4. **自动推送：** 更新后自动推送到GitHub
5. **自动部署：** Netlify自动检测并部署（1-2分钟）
6. **验证要求：** 每次推送前必须验证所有接口正常

**🔥 重要：所有更新必须同步到GitHub**

> **所有健康看板相关的更新（包括代码、数据、文档、图表等），必须立即同步到GitHub仓库。只有同步到GitHub，Netlify才能自动更新到外网域名。**

**GitHub同步要求：**
- ✅ 每次代码修改后立即git add + commit + push
- ✅ 每次数据更新后立即git add + commit + push
- ✅ 每次图表生成后立即git add + commit + push
- ✅ 每次文档修改后立即git add + commit + push
- ✅ **绝对不允许**只修改本地文件而不推送到GitHub
- ✅ **绝对不允许**延迟推送（特殊情况除外，需说明原因）

**同步命令（必须记住）：**
```bash
cd Personal/Health
git add .
git commit -m "描述更新的内容"
git push
```

**验证同步成功：**
- 访问GitHub仓库查看最新commit
- 等待1-2分钟后访问在线网站验证
- 确认在线网站已显示最新内容

**数据更新清单：**
- [ ] Oura Ring数据（昨天的睡眠质量和准备度）
- [ ] 天气数据（今天实时天气）
- [ ] 空气质量数据（今天实时空气质量）
- [ ] 训练日志（有道云笔记中昨天的记录）
- [ ] 所有图表重新生成（8个matplotlib图表）
- [ ] HTML看板更新（所有版本）
- [ ] 推送到GitHub仓库
- [ ] Netlify自动部署

**自动化方式：**
- GitHub Actions工作流：`.github/workflows/daily-update.yml`
- Cron表达式：`0 3 * * *`（UTC 3:00 = 北京时间 11:00）
- 工作流文件必须包含在仓库中

**手动方式（备选）：**
```bash
cd Personal/Health
python3 ultimate_dashboard.py
git add .
git commit -m "Daily update: $(date +'%Y-%m-%d')"
git push
```

**违规后果：**
- 如果11:00没有自动推送，视为严重失误
- 必须立即手动推送更新
- 必须检查自动化流程是否正常

---

### 🚨 死命令 #5：训练建议限制

**命令内容：**
> **日常训练建议只提泳池训练和陆地训练，绝对禁止提及"深度训练"、"深度挑战"、"CWT"、"CNF"、"DYN"、"DNF"等任何深度潜水相关术语。**

**允许的训练内容：**
- ✅ 无蹼 (No-fin)
- ✅ 单蹼 (Single-fin/Monofin)
- ✅ 双蹼 (Bifins)
- ✅ 静态闭气 (Static Apnea)
- ✅ 1000米蛙泳
- ✅ 陆地训练（瑜伽、拉伸、核心力量）
- ✅ 低心率有氧（骑行、跑步）

**禁止的训练内容：**
- ❌ 深度训练
- ❌ 深度挑战
- ❌ CWT (Constant Weight)
- ❌ CNF (Constant No-Fins)
- ❌ DYN (Dynamic)
- ❌ DNF (Dynamic No-Fins)
- ❌ 深海潜水

**唯一例外：**
只有当用户明确告知要去海边或深度泳池时，才能提供深度训练建议。

---

## 📋 完整需求清单

### 一、健康数据来源（必须全部包含）

#### 1.1 Oura Ring数据（必须）
**数据项：**
- 准备度分数 (Readiness Score)
- 5项贡献指标：
  - HRV平衡
  - 恢复指数
  - 静息心率
  - 睡眠平衡
  - 活动平衡
- 睡眠分数 (Sleep Score)
- 7项睡眠指标：
  - 总睡眠质量
  - 深睡质量
  - REM睡眠质量
  - 睡眠效率
  - 入睡速度
  - 睡眠安享度
  - 睡眠时间规律
- 活动数据 (Activity)
- 心率数据 (Heart Rate)

#### 1.2 天气数据（必须）
**数据项：**
- 当前温度
- 体感温度
- 湿度
- 风速
- 日出时间
- 日落时间
- 紫外线指数
- 穿衣建议

#### 1.3 空气质量数据（必须）
**数据项：**
- AQI指数
- PM2.5
- PM10
- 数据来源说明
- 训练建议（基于空气质量）

#### 1.4 8Sleep数据（可选，如果配置）
**数据项：**
- 睡眠总分
- 总睡眠时长
- 浅睡/深睡/REM时长
- 入睡时间
- 翻身次数
- 平均呼吸率
- 平均心率
- 最低心率
- 床垫温度
- 房间温度

---

### 二、饮食建议（必须完整）

#### 2.1 两餐制饮食（必须）
**第一餐（午餐 12:30）：**
- 主菜详细说明
- 复合碳水详细说明
- 蔬菜详细说明
- 优质脂肪详细说明
- 营养元素表格（必须包含）
- 第一餐补剂清单
- 热量分配

**第二餐（晚餐 18:30-19:00）：**
- 主菜详细说明
- 复合碳水详细说明
- 蔬菜沙拉详细说明
- 营养元素表格（必须包含）
- 第二餐补剂清单
- 热量分配

**热量分配：**
- 高强度训练日：3000 kcal
- 中等强度训练日：2600 kcal
- 恢复日：2200 kcal

**营养比例：**
- 蛋白质：30%
- 脂肪：35%
- 碳水：35%

#### 2.2 补剂检查清单（必须）
**早晨空腹（7:00）：**
- NMN22000 1粒
- 益生菌 1粒

**随餐（午餐后）：**
- 鱼油 2粒
- 维生素D3 2粒

**训练中/训练后：**
- BCAA 5-10g（可选）
- 电解质（训练超过1小时）
- 蛋白粉 30g（训练后30分钟内）

**睡前（睡前30分钟）：**
- 镁 2粒（400mg）
- 锌 15mg（如果需要）

**隔日服药日：**
- 异维A酸 10mg（偶数日：2、4、6、...30日）

#### 2.3 营养元素详细说明（必须包含）
**微量元素表格：**
- 蛋白质来源及含量
- Omega-3来源及含量
- 复合碳水化合物来源
- 膳食纤维
- 维生素（C、A、D等）
- 矿物质（钾、镁、锌、硒等）

#### 2.4 饮食注意事项（必须）
**因异维A酸需避免：**
- 动物肝脏
- 维生素A补充剂
- 胡萝卜素补充剂

**训练日特别注意：**
- 训练前2小时：完成第一餐
- 训练前30分钟：轻食（香蕉+MCT油）
- 训练后30分钟：蛋白质+快速碳水
- 晚间：避免过多脂肪

---

### 三、训练建议（必须完整详细）

#### 3.1 每日具体推荐（必须包含）
根据准备度分数给出三级建议：

**🔥 高强度训练日（准备度≥85，恢复指数≥75）：**
- 晨起：空腹低心率骑行30分钟
- 上午：泳池基础训练（四项基础强化）
- 下午：1000米蛙泳测试或技术突破
- 晚上：轻度拉伸恢复
- 小憨眯一下建议
- 营养建议

**💪 中等强度训练日（准备度≥70）：**
- 晨起：低心率有氧20-30分钟
- 上午：泳池技术训练（四项基础）
- 下午：核心力量训练或陆地训练
- 晚上：拉伸放松
- 小憨眯一下建议
- 营养建议

**🧘 恢复日（准备度<70）：**
- 晨起：轻度活动或休息
- 上午：瑜伽或拉伸
- 下午：轻松散步或水中放松游
- 晚上：充分休息
- 小憨眯一下建议
- 营养建议
- 特别提醒

#### 3.2 泳池训练建议（必须完整）

**热身阶段（15分钟，必须包含）：**
- 时间分配（07:00-10:30）
- 陆上热身5分钟（详细动作）
- 水中热身10分钟（详细内容）
- 热身要点
- 常见错误

**四项基础训练（必须完整详细）：**

**(a) 无蹼训练（No-Fin）：**
- 训练量：25米x4组、50米x3组、75米x2组
- 组间休息：2-3分钟
- 技术要点（必须包含）
- 常见错误（必须包含）
- 监控指标（必须包含）

**(b) 单蹼训练（Monofin）：**
- 训练量：50米x4组、75米x3组
- 组间休息：3-4分钟
- 技术要点（必须包含）
- 常见错误（必须包含）
- 监控指标（必须包含）

**(c) 双蹼训练（Bifins）：**
- 训练量：50米x4组、75米x3组
- 组间休息：4-5分钟
- 技术要点（必须包含）
- 常见错误（必须包含）
- 监控指标（必须包含）

**(d) 静态闭气训练（Static Apnea）：**
- 训练量：干姿静态2分钟x3组
- 组间休息：5分钟
- 技术要点（必须包含）
- 常见错误（必须包含）
- 监控指标（必须包含）
- 安全提醒（必须包含）

**1000米蛙泳（核心训练，必须包含）：**
- 目标配速：1:47-1:50/100m
- 目标时间：17分56秒（PB）
- 最大心率：≤170bpm
- 平均心率：145-150bpm
- 3种训练方法（必须详细）：
  - 方法1：分段训练（技术提升）
  - 方法2：全速测试（挑战PB）
  - 方法3：负分段训练（节奏控制）
- 配速策略（必须详细）
- 技术要点（必须详细）
- 监控要点（必须详细）

#### 3.3 基于历史数据的建议（必须包含）
**从游泳记录分析（2024.8-2025.9）：**
1. 装备检查很重要
2. 持续性是进步的基础
3. 配速控制是关键
4. 心率监控
5. 细节决定成败

**个人最好成绩（必须包含）：**
- 肺活量PB：7,653ml（2024.5.27）
- 1000米蛙泳PB：17分56秒（2025.9.25）
- 配速PB：1:47/100m
- 进步历程（必须包含）

#### 3.4 周训练安排（必须包含）
**周一-周四：** 基础训练日
**周五：** 测试日
**周末：** 积极恢复

#### 3.5 注意事项（必须包含）
**训练前准备：**
- 提前15分钟到达泳池
- 检查装备
- 充分热身
- 训练前加餐

**训练中监控：**
- 每25分钟检查心率
- 每15分钟补充水分
- 关注呼吸节奏
- 保持技术流畅

**训练后恢复：**
- 30分钟内补充蛋白质+快速碳水
- 拉伸放松10-15分钟
- 记录训练数据
- 冲温水浴

**避免的错误（必须列出）：**
- 装备检查不仔细
- 配速不稳定
- 心率过高
- 训练中断
- 酒精影响
- 热身不足
- 强行训练

**安全提醒（必须包含）：**
- 静态闭气安全
- 过度换气禁止
- 心率异常处理
- 身体不适处理
- 泳池安全

#### 3.6 预期效果与周期（必须包含）
**短期效果（1-2周）**
**中期效果（4-6周）**
**长期效果（8-12周）**
**关键因素**

#### 3.7 训练记录模板（必须包含）
提供完整的训练记录模板，方便用户填写。

---

### 四、可视化图表（必须全部包含）

#### 4.1 matplotlib图表（必须生成，至少8个）
1. **readiness_radar.png** - 健康指标雷达图
2. **sleep_quality.png** - 睡眠质量柱状图
3. **activity_distribution.png** - 活动分布饼图
4. **readiness_gauge.png** - 训练准备度仪表盘
5. **30_day_trends.png** - 30天健康趋势分析
6. **sleep_quality_distribution.png** - 睡眠质量深度分析
7. **nutrition_visualization.png** - 营养摄入分析
8. **readiness_comprehensive.png** - 准备度综合分析

**要求：**
- 所有图表必须生成
- 所有图表必须美观
- 所有图表必须清晰可读
- 所有图表必须包含在HTML看板中

#### 4.2 Chart.js交互图表（必须包含，至少6个）
1. 雷达图（交互式）
2. 睡眠质量柱状图（交互式）
3. 活动分布环形图（交互式）
4. HRV趋势图（7天）
5. 周趋势折线图（准备度+睡眠双线）
6. 准备度仪表盘（动态）

**要求：**
- 所有图表必须交互式
- 悬停显示数值
- 点击高亮
- 动画效果
- 响应式设计

#### 4.3 进度条可视化（必须包含，至少5个）
1. HRV平衡进度条
2. 恢复指数进度条
3. 静息心率进度条
4. 睡眠平衡进度条
5. 活动平衡进度条

**要求：**
- 彩色渐变
- 百分比显示
- 圆角设计
- 动画效果

---

### 五、高级健康指标分析（必须包含）

#### 5.1 HRV深度分析（必须包含）
- 当前HRV数值
- 状态区间
- 5级分类系统
- 详细建议
- 趋势分析

#### 5.2 活动数据分析（必须包含）
- 活动平衡分数
- 状态评估
- 分析内容
- 建议

#### 5.3 恢复指数深度分析（必须包含）
- 恢复指数数值
- 恢复进度
- 恢复建议
- 多级恢复建议

#### 5.4 数据来源说明（必须包含）
- Oura Ring
- 科学研究
- 7个数据源
- 10+科学依据

---

### 六、个人最好成绩（必须包含）

#### 6.1 肺活量记录
- PB：7,653ml（2024.5.27）
- 注意事项
- 进步/退步规律

#### 6.2 游泳记录
- 1000米蛙泳PB：17分56秒
- 配速PB：1:47/100m
- 进步历程（详细时间线）

#### 6.3 关键发现（从训练记录）
- 装备检查重要性
- 持续性重要性
- 配速控制关键
- 心率监控重要

---

### 七、HTML看板（必须生成4个版本）

#### 7.1 Markdown看板
- 文件：dashboard_YYYY-MM-DD.md
- 内容：所有文字建议、数据、分析
- 用途：Obsidian、Typora编辑

#### 7.2 基础HTML看板
- 文件：dashboard_YYYY-MM-DD.html
- 内容：包含所有Markdown内容（pre标签）
- 用途：简单浏览器查看

#### 7.3 可视化HTML看板
- 文件：dashboard_visual_YYYY-MM-DD.html
- 内容：6个Chart.js交互图表
- 用途：交互式查看

#### 7.4 超级增强看板（推荐）
- 文件：super_dashboard.html或dashboard_with_charts.html
- 内容：
  - 所有8个matplotlib图表
  - 所有6个Chart.js图表
  - 所有5个进度条
  - 所有详细建议
  - 美化设计
  - 自动刷新（5分钟）
- 用途：专业可视化查看

**要求：**
- 所有4个版本必须生成
- 所有版本必须正常工作
- 所有图表必须显示
- 所有文字必须完整
- 绝对不允许顾此失彼

---

### 八、推送通知（必须包含）

- macOS推送通知
- 标题：准备度分数
- 内容：状态+建议摘要
- 声音：Glass

---

### 九、数据验证（必须包含）

#### 9.1 完整性验证
每次生成后必须验证：
- [ ] 📊 今日健康评分
- [ ] 🌤️ 今日天气
- [ ] 🌬️ 空气质量
- [ ] 🎯 训练建议
- [ ] 💡 今日具体推荐
- [ ] 🏊 泳池训练建议
- [ ] 🍽️ 两餐饮食计划
- [ ] 💊 补剂提醒
- [ ] 🏆 个人最好成绩
- [ ] 📈 高级健康指标分析
- [ ] 📊 健康指标可视化

#### 9.2 图表验证
每次生成后必须验证：
- [ ] 所有8个matplotlib图表已生成
- [ ] 所有图表文件大小合理（>30KB）
- [ ] 所有图表在HTML中正常显示
- [ ] 所有交互图表功能正常

#### 9.3 功能验证
每次生成后必须验证：
- [ ] 所有数据正确显示
- [ ] 所有建议内容完整
- [ ] 所有图表正常显示
- [ ] 没有任何功能缺失
- [ ] 没有任何内容丢失

---

### 十、死命令执行检查清单

每次更新看板前，必须完成以下检查：

#### 步骤1：阅读需求文档
- [ ] 完整阅读本文档
- [ ] 理解所有要求
- [ ] 标记即将更新的部分

#### 步骤2：更新代码
- [ ] 只增加新功能，不删除旧功能
- [ ] 保留所有已有图表
- [ ] 保留所有已有建议
- [ ] 添加新功能在旧功能之后

#### 步骤3：测试验证
- [ ] 运行完整系统
- [ ] 检查所有图表是否生成
- [ ] 检查所有建议是否包含
- [ ] 检查所有数据是否正确

#### 步骤4：完整性检查
- [ ] 对照本文档逐条检查
- [ ] 确认没有遗漏任何要求
- [ ] 确认没有删除任何内容
- [ ] 确认所有功能正常

#### 步骤5：最终验证
- [ ] 打开所有HTML看板
- [ ] 确认所有图表显示
- [ ] 确认所有文字显示
- [ ] 确认交互功能正常

**只有完成以上所有步骤，才能提交更新！**

---

## 📋 完整内容清单（终极版）

### 必须包含的章节（按顺序）：
1. 📊 今日健康评分
2. 😴 睡眠质量 (Sleep Score)
3. 🌤️ 今日天气
4. 🌬️ 空气质量
5. 🎯 训练建议
6. 💡 今日具体推荐
7. 🏊 泳池训练建议（必须完整详细）
8. 🍽️ 两餐饮食计划（必须完整详细）
9. 💊 补剂提醒
10. 📈 高级健康指标分析
11. 📊 健康指标可视化（进度条）
12. 🏆 个人最好成绩

### 必须包含的可视化：
1. 8个matplotlib图表
2. 6个Chart.js图表
3. 5个进度条
4. 美化设计
5. 自动刷新

### 必须包含的详细建议：
1. 热身阶段（15分钟详细）
2. 四项基础训练（每项详细）
3. 1000米蛙泳训练（3种方法）
4. 基于历史数据的建议
5. 周训练安排
6. 注意事项
7. 安全提醒
8. 预期效果
9. 训练记录模板

---

## 🚨 常见错误（必须避免）

### 错误1：更新后图表消失
**症状：** 更新建议后，图表不见了
**原因：** 忘记生成图表，或HTML没有包含图表
**预防：** 每次更新后必须验证所有图表都存在

### 错误2：更新后建议消失
**症状：** 更新图表后，建议文字不见了
**原因：** 简化了内容，或重新生成了markdown
**预防：** 每次更新后必须验证所有建议都存在

### 错误3：顾此失彼
**症状：** 增加一个功能，丢失另一个功能
**原因：** 没有对照需求文档检查
**预防：** 每次更新前必须完整阅读需求文档

### 错误4：深度训练内容混入
**症状：** 建议中出现"深度训练"、"CWT"等
**原因：** 没有严格执行训练限制
**预防：** 生成后必须搜索这些关键词并移除

---

## 📝 更新流程（标准流程）

### 标准更新流程：
1. **阅读需求** - 完整阅读本文档
2. **理解需求** - 理解所有要修改的部分
3. **规划更新** - 规划如何修改，确保不影响其他功能
4. **修改代码** - 只增加，不删除
5. **测试运行** - 运行完整系统
6. **验证图表** - 确认所有图表都生成
7. **验证建议** - 确认所有建议都包含
8. **验证HTML** - 确认所有版本都正常
9. **对照检查** - 对照本文档逐条检查
10. **最终提交** - 只有所有检查通过才提交

---

## 🎯 成功标准

更新成功的标准：
- ✅ 所有图表都存在且正常显示
- ✅ 所有建议都完整且详细
- ✅ 所有数据都正确显示
- ✅ 没有任何功能缺失
- ✅ 没有任何内容丢失
- ✅ 所有HTML版本都正常工作
- ✅ 用户体验优于之前

---

## 📊 历史问题记录

### 问题1：可视化消失（2026-02-04）
**原因：** 更新建议时没有生成图表
**解决：** 每次更新都必须生成所有图表
**预防：** 检查清单必须包含图表验证

### 问题2：建议内容消失（2026-02-04）
**原因：** 更新图表时简化了内容
**解决：** 每次更新都必须保留所有建议
**预防：** 检查清单必须包含内容验证

### 问题3：深度训练内容混入（2026-02-04）
**原因：** training_data_analyzer.py中还有深度术语
**解决：** 搜索所有文件，移除所有深度术语
**预防：** 生成后必须搜索这些关键词

---

## ⚠️ 最后警告

**本需求文档是金明健康看板系统的最高指导文档。**

**每次更新前必须：**
1. 完整阅读本文档
2. 理解所有要求
3. 规划更新方案
4. 确保不影响其他功能

**每次更新后必须：**
1. 验证所有图表存在
2. 验证所有建议完整
3. 验证所有功能正常
4. 对照本文档检查

**绝对禁止：**
1. 删除任何已有内容
2. 简化任何已有内容
3. 替换任何已有内容
4. 顾此失彼

**违反后果：**
- 会被严厉批评
- 必须立即修复
- 必须重新检查所有功能

---

**文档版本：** v1.0 - 终极版
**创建时间：** 2026-02-04
**状态：** ⚠️ **死命令 - 必须严格执行**
**优先级：** **最高（超越所有其他文档）**

---

*本文档包含所有历史需求和指令，以后每次更新前必须检查本文档！*
*本本文档是金明健康看板系统的最高指导文档！*
